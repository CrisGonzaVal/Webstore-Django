<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Larrain Webstore</title>
    {% load static %} 
    <link rel="icon" type="image/png" href="{% static '/app/imagenes/logo/l.png' %}">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <script src="{% static '/app/JS/valorDolar.js' %}" defer></script>
    <link rel="stylesheet" href="{% static '/app/CSS/base.css' %}"> 

    <!-- PayPal SDK Script -->
    <script src="https://www.paypal.com/sdk/js?client-id={{ settings.PAYPAL_CLIENT_ID }}&currency=USD" defer></script>
</head>
<body>

    <header>

        <!-- barra encabezado -->
        <div class="navbar-sticky">   
            <div class="container">
                <nav class="navbar navbar-expand-lg">
                    <div class="container-fluid">
                        <a href="{% url 'home' %}"><img src="{% static '/app/imagenes/logo/logotipo.png' %}" alt="logotipo" width="auto" height="80px"></a>
                        <form class="d-flex w-50" role="search">
                            <input class="form-control me-2" type="search" placeholder="buscar" aria-label="Search">
                            <button class="btn btn-primary" type="submit">Buscar</button>
                        </form>
                        <a href=""><img class="campana" src="{% static '/app/imagenes/logo/campana.png' %}" alt="notificacion" width="auto" height="30px"><span class="top-0 start-100 translate-middle badge rounded-pill bg-danger">0</span></a>
                        <a href="{% url 'carro' %}"><img src="{% static '/app/imagenes/logo/carrito-de-compras.png' %}" alt="carro" width="auto" height="40px"><span class="top-0 start-100 translate-middle badge rounded-pill bg-danger">{{ total_items_carrito }}</span></a>
                        <div class="dropdown">
                            <img data-bs-toggle="dropdown" src="{% static '/app/imagenes/logo/acceso.png' %}" alt="acceso" width="auto" height="40px">
                            <ul class="dropdown-menu dropdown-menu-primary">
                                <li><a class="dropdown-item" href="{% url 'login' %}">Iniciar sesi√≥n</a></li>
                                <li><hr class="dropdown-divider"></li>
                                <li><a class="dropdown-item" href="{% url 'registro' %}">Registrarse</a></li>
                                <li><hr class="dropdown-divider"></li>
                                <li><a class="dropdown-item" href="http://127.0.0.1:8000/admin/">Empleados</a></li>
                            </ul>
                        </div>
                        <!--VISUALIZACION DEL API VALOR DOLAR-->
                        <h6 id="valor-dolar"></h6>
                    </div>
                </nav>
            </div>
        </div>
        
        <!-- menu de navegacion -->
        <div class="menuNav">
            <nav class="navbar navbar-expand-lg navbar-dark bg-primary p-4">
                <div class="container">
                    <a class="navbar-brand" href="{% url 'home' %}">Home</a>
                    <a class="navbar-brand" href="{% url 'ofertas' %}">Ofertas</a>
                    <a class="navbar-brand" href="{% url 'catalogo' %}">Catalogo</a>
                    <a class="navbar-brand" href="{% url 'proveedores' %}">Proveedores</a>
                    <a class="navbar-brand" href="{% url 'contactanos' %}">Contactanos</a>
                </div>
            </nav>
        </div>

    </header>

    {% block contenido%}
    {% endblock %}

    <!-- pie de pagina -->
    <footer>
        <nav class="navbar navbar-expand-lg bg-body-secondary p-4">
            <div class="container-fluid">
                <small>&copy;<b>2024 Blocks, Inc. All rights reserved. </b></small>
                <ul class="navbar-nav">
                    <li class="nav-item dropdown me-5">
                        <a target="_blank" href="https://www.facebook.com"><img src="{% static '/app/imagenes/logo/facebook.png' %}" alt="facebook" width="auto" height="40px"></a>
                    </li>

                    <li class="nav-item dropdown me-5">
                        <a target="_blank" href="https://www.twitter.com"><img src="{% static '/app/imagenes/logo/twiter.png' %}" alt="twitter" width="auto" height="40px"></a>
                    </li>

                    <li class="nav-item dropdown me-5">
                        <a target="_blank" href="https://www.instagram.com"><img src="{% static '/app/imagenes/logo/instagram.png' %}" alt="instagram" width="auto" height="40px"></a>
                    </li>

                    <li class="nav-item dropdown me-5">
                        <a target="_blank" href="https://www.linkedin.com"><img src="{% static '/app/imagenes/logo/linkedin.png' %}" alt="linkedin" width="auto" height="40px"></a>
                    </li>
                </ul>
            </div>
        </nav>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const cartItems = JSON.parse('{{ carrito_items|escapejs }}');

            window.paypal.Buttons({
                style: {
                    shape: 'rect',
                    layout: 'vertical',
                    color: 'gold',
                    label: 'paypal',
                },
                createOrder: function(data, actions) {
                    return fetch('/api/orders', {
                        method: 'post',
                        headers: {
                            'content-type': 'application/json'
                        },
                        body: JSON.stringify({
                            cart: cartItems
                        })
                    }).then(function(res) {
                        return res.json();
                    }).then(function(orderData) {
                        if (orderData.id) {
                            return orderData.id;
                        } else {
                            throw new Error('Order creation failed.');
                        }
                    }).catch(function(err) {
                        console.error('Create order error:', err);
                    });
                },
                onApprove: function(data, actions) {
                    return fetch(`/api/orders/${data.orderID}/capture`, {
                        method: 'post',
                        headers: {
                            'content-type': 'application/json'
                        }
                    }).then(function(res) {
                        return res.json();
                    }).then(function(orderData) {
                        if (orderData.purchase_units) {
                            console.log('Capture result', orderData, JSON.stringify(orderData, null, 2));
                            const transaction = orderData.purchase_units[0].payments.captures[0];
                            alert(`Transaction ${transaction.status}: ${transaction.id}`);
                        } else {
                            throw new Error('Capture failed.');
                        }
                    }).catch(function(err) {
                        console.error('Capture order error:', err);
                    });
                }
            }).render('#paypal-button-container');
        });
    </script>
</body>
</html>
